<div style="max-width: 500px; margin: 0 auto; padding: 20px; font-family: sans-serif; background-color: #f0f0f0; min-height: 100vh;">
  <h2 style="text-align: center; color: #333; font-weight: 900; margin-bottom: 25px;">üèÜ Ê≠£Ëß£È†Ü‰Ωç„ÇíÂÖ•Âäõ</h2>

  <%= form_with model: @competition, local: true do |f| %>
    <div id="answer-items-container">
      <%# „Éá„Éï„Ç©„É´„Éà„Åß6Êû†„ÄÅ„Åæ„Åü„ÅØÊó¢„Å´„Åù„Çå‰ª•‰∏ä‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„Åù„ÅÆÊï∞ÂàÜË°®Á§∫ %>
      <% display_count = [@competition.answer_colors&.size || 0, 6].max %>
      <% display_count.times do |i| %>
        <div class="answer-item" style="margin-bottom: 25px;">
          <h3 class="item-number" style="background-color: #B0B0B0; display: inline-block; padding: 5px 20px; font-size: 18px; margin-bottom: 10px; border: 1px solid #888; font-weight: bold;">
            <%= i + 1 %>‰Ωç
          </h3>
          
          <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 4px; background: #fff; padding: 8px; border: 1px solid #999;">
            <% [
              "#FF0000", "#0000FF", "#00FFFF", "#FFFF00", "#FFA500", "#008000", 
              "#800000", "#FFFFFF", "#B8860B", "#000000", "#ADFF2F", "#000080"
            ].each do |color| %>
              <label style="cursor: pointer;">
                <input type="radio" 
                       name="competition[answer_colors][<%= i %>]" 
                       value="<%= color %>" 
                       <%= 'checked' if @competition.answer_colors&.[](i) == color %> 
                       class="swatch-radio"
                       style="display: none;">
                <div class="swatch-cell" style="background-color: <%= color %>; width: 100%; aspect-ratio: 1/1; border: 1px solid #ccc; box-sizing: border-box;"></div>
              </label>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <%# --- Êû†„ÇíÂ¢ó„ÇÑ„Åô„Éú„Çø„É≥ --- %>
    <div style="text-align: center; margin-bottom: 30px;">
      <button type="button" id="add-answer-button" style="background: #555; color: white; border: none; padding: 12px 24px; border-radius: 30px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 0 #333;">
        Ôºã È†Ü‰Ωç„ÇíËøΩÂä†„Åô„Çã
      </button>
    </div>

    <div style="text-align: center; margin-top: 50px; padding-bottom: 50px;">
      <div style="background-color: #E0E0E0; border: 3px solid #000; padding: 20px; display: inline-block; width: 100%; box-sizing: border-box;">
        <%= f.submit "Ê≠£Ëß£„ÇíÁ¢∫ÂÆö„Åó„Å¶ÁµêÊûú„ÇíË¶ã„Çã", style: "background: none; border: none; font-size: 24px; font-weight: bold; cursor: pointer; width: 100%; color: #000;" %>
      </div>
      <%= link_to "„Ç≠„É£„É≥„Çª„É´", predictions_path(competition_id: @competition.id), style: "display: block; margin-top: 20px; color: #666; text-decoration: none;" %>
    </div>
  <% end %>
</div>

<style>
  .swatch-radio:checked + .swatch-cell { 
    outline: 4px solid #000; 
    outline-offset: -4px; 
    position: relative; 
    z-index: 1; 
    transform: scale(0.95);
  }
  .swatch-cell[style*="#FFFFFF"] { border: 1px solid #aaa !important; }
  #add-answer-button:active { transform: translateY(2px); box-shadow: 0 2px 0 #333; }
</style>

<script>
  const initAddAnswerButton = () => {
    const addButton = document.getElementById("add-answer-button");
    const container = document.getElementById("answer-items-container");
    if (!addButton || !container) return;

    addButton.replaceWith(addButton.cloneNode(true));
    const newAddButton = document.getElementById("add-answer-button");

    newAddButton.addEventListener("click", () => {
      const items = container.querySelectorAll(".answer-item");
      const nextIndex = items.length;
      const firstItem = items[0];
      const newItem = firstItem.cloneNode(true);
      
      newItem.querySelector(".item-number").innerText = (nextIndex + 1) + "‰Ωç";
      
      const radios = newItem.querySelectorAll('input[type="radio"]');
      radios.forEach(radio => {
        radio.name = `competition[answer_colors][${nextIndex}]`;
        radio.checked = false;
        radio.id = `answer_color_${nextIndex}_${Math.random().toString(36).substr(2, 5)}`;
      });

      container.appendChild(newItem);
    });
  };

  document.addEventListener("DOMContentLoaded", initAddAnswerButton);
  document.addEventListener("turbo:load", initAddAnswerButton);
</script>