<div class="index-container" style="max-width: 600px; margin: 0 auto; padding: 20px; font-family: sans-serif; background-color: #D3D3D3; min-height: 100vh;">
  <h1 style="text-align: center; color: #333; margin-bottom: 20px;">ã¿ã‚“ãªã®äºˆæƒ³</h1>

  <%# --- æ­£è§£ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæ­£è§£ãŒã‚ã‚‹æ™‚ã ã‘è¡¨ç¤ºï¼‰ --- %>
  <% if @competition&.answer_colors.present? %>
    <div style="background: #FFD700; border: 3px solid #000; border-radius: 15px; padding: 15px; margin-bottom: 30px; box-shadow: 6px 6px 0 #b8860b;">
      <h2 style="text-align: center; font-size: 18px; margin-bottom: 10px;">ğŸ† ä»Šå›ã®æ­£è§£ ğŸ†</h2>
      <div style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;">
        <% @competition.answer_colors.each_with_index do |color, i| %>
          <div style="text-align: center; width: 45px;">
            <div style="width: 100%; aspect-ratio: 1/1; border-radius: 50%; background-color: <%= color %>; border: 2px solid #000;"></div>
            <span style="font-size: 10px; font-weight: bold;"><%= i + 1 %></span>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <div class="prediction-history">
    <% @predictions.reverse_each do |prediction| %>
      <% 
        # çš„ä¸­ã‚«ã‚¦ãƒ³ãƒˆç”¨
        correct_count = 0
        if @competition&.answer_colors.present?
          prediction.ranking_items.order(:rank).each_with_index do |item, index|
            correct_count += 1 if item.color_code == @competition.answer_colors[index]
          end
        end
      %>

      <div class="prediction-card" style="position: relative; background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px; border: 2px solid #999;">
        
        <%# --- çš„ä¸­ãƒãƒƒã‚¸ --- %>
        <% if @competition&.answer_colors.present? %>
          <div style="position: absolute; top: -10px; right: -10px; background: #ff4500; color: white; border-radius: 50%; width: 50px; height: 50px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 3px solid #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.2); z-index: 10;">
            <span style="font-size: 14px; font-weight: bold; line-height: 1;"><%= correct_count %></span>
            <span style="font-size: 8px;">çš„ä¸­!</span>
          </div>
        <% end %>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px;">
          <span style="font-size: 18px; font-weight: bold; color: #333;"><%= prediction.name.presence || "ç„¡åã®äºˆæƒ³" %></span>
          <%= button_to "Ã—", prediction_path(prediction), method: :delete, data: { turbo_confirm: "æœ¬å½“ã«æ¶ˆã—ã¡ã‚ƒã†ã‚ˆï¼Ÿ" }, style: "background: #ff4d4d; color: white; border: none; border-radius: 4px; width: 28px; height: 28px; cursor: pointer; font-weight: bold;" %>
        </div>
        
        <div style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: flex-start;">
          <% prediction.ranking_items.order(:rank).each_with_index do |item, index| %>
            <% is_correct = @competition&.answer_colors.present? && item.color_code == @competition.answer_colors[index] %>
            <div style="text-align: center; width: calc(100% / 6 - 8px); min-width: 45px; margin-bottom: 10px;">
              <div style="width: 100%; aspect-ratio: 1/1; border-radius: 50%; background-color: <%= item.color_code %>; border: <%= is_correct ? '4px solid #ff4500' : '1px solid #ccc' %>; box-sizing: border-box; box-shadow: <%= is_correct ? '0 0 10px #ff4500' : 'none' %>;"></div>
              <span style="font-size: 10px; font-weight: bold; color: <%= is_correct ? '#ff4500' : '#888' %>;"><%= item.rank %></span>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <%# --- ä¸‹éƒ¨ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ --- %>
  <div style="text-align: center; margin-top: 30px; padding-bottom: 50px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
    <%= link_to "ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹", root_path, style: "background-color: #eee; color: #333; text-decoration: none; padding: 12px 18px; border: 2px solid #333; font-weight: bold; box-shadow: 4px 4px 0 #999; font-size: 13px;" %>
    <%= link_to "æ–°ã—ãäºˆæƒ³ã™ã‚‹", new_prediction_path, style: "background-color: #fff; color: #000; text-decoration: none; padding: 12px 18px; border: 2px solid #000; font-weight: bold; box-shadow: 4px 4px 0 #000; font-size: 13px;" %>
    <% if @competition %>
      <%= link_to "æ­£è§£ã‚’å…¥åŠ›", edit_competition_path(@competition), style: "background-color: #FFD700; color: #000; text-decoration: none; padding: 12px 18px; border: 2px solid #000; font-weight: bold; box-shadow: 4px 4px 0 #b8860b; font-size: 13px;" %>
    <% end %>
  </div>
</div>